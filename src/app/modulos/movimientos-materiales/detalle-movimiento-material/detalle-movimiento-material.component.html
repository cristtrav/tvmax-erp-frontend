<div class="inner-content">
    <div class="main-breadcrumb">
        <nz-breadcrumb>
            <nz-breadcrumb-item>
                <a routerLink="/app/dashboard"><i nz-icon nzType="home"></i></a>
            </nz-breadcrumb-item>
            <nz-breadcrumb-item>
                <a routerLink="/app/movimientosmateriales">Movimientos de materiales</a>
            </nz-breadcrumb-item>
            <nz-breadcrumb-item>
                {{ idMovimientoMaterial | titlecase }}
            </nz-breadcrumb-item>
        </nz-breadcrumb>
    </div>
    <div class="module-container">
        <div nz-row [nzGutter]="[8,8]">
            <div nz-col nzSpan="14">
                <div class="module-content">
                    <div nz-row [nzGutter]="[8,8]">
                        <div nz-col nzSpan="24">
                            <app-buscador-materiales
                                [disabled]="formCabecera.controls.tipoMovimiento.value == 'DE'"
                                (materialSelected)="tablaDetallesMovimientosComp.agregarDetalleMovimiento($event)">
                            </app-buscador-materiales>
                        </div>
                        <div nz-col nzSpan="24">
                            <app-tabla-detalles-movimientos [tipoMovimiento]="formCabecera.controls.tipoMovimiento.value"></app-tabla-detalles-movimientos>
                        </div>
                    </div>
                </div>
            </div>
            <div nz-col nzSpan="10">
                <div class="module-content">
                    <form nz-form [formGroup]="formCabecera">
                        <nz-form-item>
                            <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="6" nzRequired>
                                <span>Fecha</span>
                            </nz-form-label>
                            <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="17"
                                nzErrorTip="Ingrese la fecha.">
                                <nz-date-picker
                                    style="width: 100%;"
                                    nzFormat="dd/MM/yyyy"
                                    formControlName="fecha"
                                    [nzDisabledDate]="disabledDate">
                                </nz-date-picker>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item>
                            <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="6" nzRequired>
                                Tipo
                            </nz-form-label>
                            <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="17"
                                nzErrorTip="Seleccione el tipo de movimiento.">
                                <nz-radio-group formControlName="tipoMovimiento">
                                    <label *ngIf="opcionSAHabilitada()" nz-radio-button nzValue="SA">
                                        <i nz-icon nzType="upload" nzTheme="outline"></i>
                                        Salida
                                    </label>
                                    <label *ngIf="opcionENHabilitada()" nz-radio-button nzValue="EN">
                                        <i nz-icon nzType="download" nzTheme="outline"></i>
                                        Entrada
                                    </label>
                                    <label *ngIf="opcionAJHabilitada()" nz-radio-button nzValue="AJ">
                                        <i nz-icon nzType="control" nzTheme="outline"></i>
                                        Ajuste
                                    </label>
                                    <label *ngIf="formCabecera.controls.tipoMovimiento.value == 'DE'" nz-radio-button nzValue="DE">
                                        <i nz-icon nzType="import" nzTheme="outline"></i>
                                        Devoluci칩n
                                    </label>
                                </nz-radio-group>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item *ngIf="setMostrarUsuarioTipo.has(formCabecera.controls.tipoMovimiento.value ?? '')">
                            <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="6" 
                                [nzRequired]="formCabecera.controls.tipoMovimiento.value == 'SA'">
                                <span *ngIf="formCabecera.controls.tipoMovimiento.value == null">Usuario</span>
                                <span *ngIf="formCabecera.controls.tipoMovimiento.value == 'SA'">Entregado a</span>
                                <span *ngIf="formCabecera.controls.tipoMovimiento.value == 'DE' ||
                                    formCabecera.controls.tipoMovimiento.value == 'EN'">
                                Entregado por
                            </span>
                            </nz-form-label>
                            <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="17"
                                nzErrorTip="Seleccione el responsable.">
                                <nz-select
                                    nzPlaceHolder="Seleccionar..."
                                    formControlName="idUsuarioEntrega"                                    
                                    nzAllowClear>
                                    <nz-option
                                        *ngFor="let usuario of lstUsuarios"
                                        [nzValue]="usuario.id"
                                        [nzLabel]="usuario.razonsocial">
                                    </nz-option>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item>
                            <nz-form-label [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="6">
                                Observaci칩n
                            </nz-form-label>
                            <nz-form-control [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="17"
                                nzErrorTip="M치x. 150 car치cteres.">
                                <input nz-input formControlName="observacion">
                            </nz-form-control>
                        </nz-form-item>
                        <div nz-row [nzGutter]="[8, 8]" nzJustify="end">                                    
                            <div nz-col>
                                <button nz-button nzType="default" (click)="limpiar()">
                                    <i *ngIf="idMovimientoMaterial === 'nuevo'" nz-icon nzType="clear" nzTheme="outline"></i>
                                    <i *ngIf="idMovimientoMaterial !== 'nuevo'" nz-icon nzType="plus" nzTheme="outline"></i>
                                    {{ idMovimientoMaterial === 'nuevo' ? 'Limpiar' : 'Nuevo' }}
                                </button>
                            </div>
                            <div nz-col>
                                <button
                                    nz-button
                                    nzType="primary"
                                    style="width: 100%;"
                                    (click)="guardar()"
                                    [nzLoading]="guardandoMovimiento">
                                    <i nz-icon nzType="save"></i>
                                    {{ idMovimientoMaterial == 'nuevo' ? 'Registrar' : 'Editar' }}
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>